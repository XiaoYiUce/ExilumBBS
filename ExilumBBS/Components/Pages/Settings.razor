@page "/settings"
@using ExilumBBS.State

@inject AppState appState
@inject UserState userState
@inject ITokenService tokenService
@inject IUserService userService
@inject IPopupService popupService
@inject NavigationManager navigation

@layout WithBackLayout

<MCellGroup>
    <MCell Title="退出登录" OnClick="Logout"></MCell>
</MCellGroup>


@code {
    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();
        // 设置AppBar标题
        appState.WithbackLayoutState.AppBarTitle = "设置";
    }

    private async Task Logout()
    {
        var confirmed = await popupService.ConfirmAsync("退出登录", "您确定要退出当前账户吗?", AlertTypes.Warning);
        if (confirmed)
        {
            if (userState.Token != null)
            {
                await tokenService.DeleteTokenAsync(userState.Token);
            }

            if (userState.CurrentUserProfile != null)
            {
                await userService.DeleteUserProfile(userState.CurrentUserProfile.Uid);
            }

            navigation.NavigateTo("/");
        }
    }
}
